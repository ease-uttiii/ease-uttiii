<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>依頼一覧 | 管理用画面</title>
    <style>
       :root { --mauve-admin: #8e7a8a; --pink-light: #fdf8f7; }
body { font-family: 'Noto Sans JP', sans-serif; background: var(--pink-light); color: #5a4d4d; margin: 0; padding: 15px; line-height: 1.5; }

header { background: var(--mauve-admin); color: white; padding: 15px; text-align: center; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
h1 { margin: 0; font-size: 1.1rem; letter-spacing: 0.05em; }

.list-container { max-width: 600px; margin: 0 auto; }
.card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; border-left: 6px solid var(--mauve-admin); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

.card-header { display: flex; justify-content: space-between; border-bottom: 1px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 15px; font-size: 0.85rem; color: #999; }
.card-id { font-weight: bold; color: var(--mauve-admin); }

/* 項目ごとのブロック */
.info-item { margin-bottom: 15px; }
.label { font-size: 0.75rem; font-weight: bold; color: var(--mauve-admin); display: block; margin-bottom: 3px; }
.content { font-size: 0.95rem; color: #333; white-space: pre-wrap; word-break: break-all; }

/* プレイ日時だけ少し大きく */
.date-content { font-size: 1.05rem; font-weight: bold; color: #444; border-bottom: 1px dashed #e0d0d0; padding-bottom: 2px; display: inline-block; }

/* 非掲載メモ（管理用） */
.private-section { margin-top: 20px; padding: 12px; background: #faf5f5; border-radius: 10px; border: 1px solid #eee; }
.private-label { font-size: 0.75rem; color: #b1a0af; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <h1>届いたプレイ依頼一覧</h1>
</header>

<div class="list-container" id="list">
    <div class="loading">データを読み込み中...</div>
</div>

<script>
// ★ここへデプロイした最新のURLを貼り付けてください★
const gasUrl = 'https://script.google.com/macros/s/AKfycbzOS0IUuf_Q-UggnZanN0Kgj4bat_LIH4GliwXz6yUblqqBaOQ5siOfGIrT6VBpzdrW3A/exec';

async function loadData() {
    const listDiv = document.getElementById('list');
    listDiv.innerHTML = '<div class="loading">データを読み込み中...</div>';
    
    try {
        // ★修正ポイント：no-corsを削除し、純粋なGETリクエストにする
        const response = await fetch(gasUrl);
        const data = await response.json();
        
        listDiv.innerHTML = '';

        if (data.length === 0) {
            listDiv.innerHTML = '<div class="loading">まだ依頼はありません。</div>';
            return;
        }

        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            
            // データを表示
            card.innerHTML = `
    <div class="card-header">
        <span class="card-id">ID: ${item.id}</span>
        <span>受付: ${new Date(item.submittedAt).toLocaleString('ja-JP')}</span>
    </div>
    
    <div class="info-item">
        <span class="label">【プレイ希望日時】</span>
        <div class="content"><span class="date-content">${item.date}</span></div>
    </div>

    <div class="info-item">
        <span class="label">【場所 / 人数】</span>
        <div class="content">${item.pref} ／ ${item.member_count}名</div>
    </div>

    <div class="info-item">
        <span class="label">【プレイ内容】</span>
        <div class="content">${item.play_content}</div>
    </div>

    <div class="info-item">
        <span class="label">【使用玩具】</span>
        <div class="content">${item.toys || 'なし'}</div>
    </div>

    <div class="info-item">
        <span class="label">【掲載用メモ】</span>
        <div class="content">${item.public_note || '-'}</div>
    </div>

    <div class="info-item">
        <span class="label">【NGリスト】</span>
        <div class="content" style="color:#d9534f;">${item.ng_list || 'なし'}</div>
    </div>

    <div class="info-item">
        <span class="label">【受検経験】</span>
        <div class="content">${item.exam_status}</div>
    </div>
    
    <div class="private-section">
        <span class="private-label">非掲載メモ（管理用）</span>
        <div class="content" style="font-size:0.9rem; color:#777; margin-top:5px;">${item.private_note || 'なし'}</div>
    </div>
`;
            listDiv.appendChild(card);
        });
    } catch (e) {
        console.error(e);
        // ★デバッグ用のメッセージ
        listDiv.innerHTML = '<div class="loading">読み込みエラー: ' + e.message + '</div>';
    }
}

loadData();
</script>
</body>
</html>